(()=>{"use strict";const e=new class{constructor(e,t){this.layout=e,this.api=t}init(){this.registerWorker(),this.layout.loadingRender(),this.articlesEl=document.querySelector(".news__articles"),this.newsEl=document.querySelector(".news"),this.addUpdateListener()}addUpdateListener(){this.updater=document.querySelector(".news__updater"),this.updater.addEventListener("click",(()=>{this.renderArticle()}))}async renderArticle(){if(this.data=await this.getArticles(),!this.data)return console.log("Controller Fail"),this.newsEl.style.opacity=.1,void this.layout.renderError();for(this.articles=this.data.articles;this.articlesEl.firstChild;)this.articlesEl.firstChild.remove();this.articles.forEach((e=>{this.layout.renderArticle(e.received,e.image,e.description)})),console.log("Success")}async getArticles(){return this.api.getArticles()}registerWorker(){navigator.serviceWorker&&window.addEventListener("load",(async()=>{try{await navigator.serviceWorker.register("./service.worker.js",{scope:"./"})}catch(e){console.log(e)}}))}}(new class{constructor(){this.body=document.body,this.container=document.createElement("div"),this.container.className="container",this.timestamp="21:30 02.01.2020",this.icon="https://www.flaticon.com/svg/vstatic/svg/4465/4465197.svg?token=exp=1618576709~hmac=45f10748628b85cbc09b6a3698a19941",this.description="laborum libero quos omnis iste laboriosam quo inventore aut magni"}loadingRender(){this.newsEl=document.createElement("div"),this.newsEl.className="news",this.newsTitleEl=document.createElement("div"),this.newsTitleEl.className="news__title",this.newsTitleEl.textContent="Новости мира кино",this.newsUpdaterEl=document.createElement("div"),this.newsUpdaterEl.className="news__updater",this.newsUpdaterEl.textContent="Обновить",this.newsArticlesEl=document.createElement("div"),this.newsArticlesEl.className="news__articles",this.newsEl.append(this.newsTitleEl,this.newsUpdaterEl,this.newsArticlesEl),this.container.append(this.newsEl),this.body.append(this.container);for(let e=0;e<2;e+=1)this.loadingArticle(this.timestamp,this.icon,this.description)}loadingArticle(e,t,i){this.articleEl=document.createElement("div"),this.articleEl.className="article",this.timestampEl=document.createElement("div"),this.timestampEl.className="article__timestamp loading",this.timestampEl.textContent=e,this.descriptionEl=document.createElement("div"),this.descriptionEl.className="article__description loading",this.descriptionEl.textContent=i,this.imageEl=document.createElement("img"),this.imageEl.className="article__image loading",this.imageEl.style.width="75px",this.imageEl.style.height="75px",this.articleEl.append(this.timestampEl,this.imageEl,this.descriptionEl),this.newsArticlesEl.append(this.articleEl)}renderArticle(e,t,i){this.articleEl=document.createElement("div"),this.articleEl.className="article",this.timestampEl=document.createElement("div"),this.timestampEl.className="article__timestamp",this.timestampEl.textContent=e,this.descriptionEl=document.createElement("div"),this.descriptionEl.className="article__description",this.descriptionEl.textContent=i,this.imageEl=document.createElement("img"),this.imageEl.src=t,this.imageEl.className="article__image",this.imageEl.style.width="75px",this.imageEl.style.height="75px",this.articleEl.append(this.timestampEl,this.imageEl,this.descriptionEl),this.newsArticlesEl.append(this.articleEl)}renderError(){this.errorEl=document.createElement("div"),this.errorEl.className="error",this.errorEl.style.width=`${document.querySelector(".news").offsetWidth}px`,this.errorEl.style.height=`${document.querySelector(".news").offsetHeight}px`,this.errorTextEl=document.createElement("div"),this.errorTextEl.className="error__text",this.p1=document.createElement("p"),this.p1.textContent="Не удалось загрузить данные",this.p2=document.createElement("p"),this.p2.textContent="Проверьте подключение",this.p3=document.createElement("p"),this.p3.textContent="и обновите страницу",this.errorTextEl.append(this.p1,this.p2,this.p3),this.errorEl.append(this.errorTextEl),this.body.append(this.errorEl)}},new class{async getArticles(){return this.response=await fetch("https://loading-back.herokuapp.com/articles").then((async e=>{this.articles=await e.json()})).catch((e=>(console.log("API Fail",e),e))),this.articles}});e.init(),e.renderArticle()})();